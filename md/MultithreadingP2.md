
 **[Back](https://orientcue.github.io/ios/ "Table of Content")**

#  Multithreading. Part 2. NSOperation. NSOperationQueue.

<!-- TOC -->
- [NSOperation](#nsoperation)
- [Create NSBlockOperation instance](#create-nsblockoperation-instance)
- [Add multiple blocks into NSBlockOperation instance](#add-multiple-blocks-into-nsblockoperation-instance)
- [Track completion of all tasks inside NSBlockOperation instance](#track-completion-of-all-tasks-inside-nsblockoperation-instance)
- [NSOperation subclassing](#nsoperation-subclassing)
- [NSOperationQueue](#nsoperationqueue)
- [Create queue](#create-queue)
- [Quality of Service](#quality-of-service)
- [Add operation into a queue](#add-operation-into-a-queue)
- [Maximum number of operations](#maximum-number-of-operations)
- [Waiting for completion](#waiting-for-completion)
- [Operation Dependencies](#operation-dependencies)
- [Cancelling Operations](#cancelling-operations)
- [Asynchronous operations](#asynchronous-operations)
- [Useful materials ü§ì](#useful-materials-)
<!-- /TOC -->

## NSOperation 

**NSOperation** ‚Äî —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤ —Å–µ–±–µ –ª–æ–≥–∏–∫—É –∏ –¥–∞–Ω–Ω—ã–µ –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ–º—ã–µ —Å –µ–¥–∏–Ω–æ–π –∑–∞–¥–∞—á–µ–π. –¢.–µ. –≤ GCD –∑–∞–¥–∞—á–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–ª–∏ —Å–æ–±–æ–π –æ–±—ã—á–Ω–æ –±–ª–æ–∫–∏ –∫–æ–¥–∞, –∑–¥–µ—Å—å –∑–∞–¥–∞—á–∞ ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å. –ö–∞–∫ –∏ GCD, NSOperation –ø–æ–∑–≤–æ–ª—è—é—Ç –≤–∞–º –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –∑–∞–¥–∞—á–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –æ—á–µ—Ä–µ–¥—è—Ö, –∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –∏ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö. –û–¥–Ω–∞–∫–æ NSOperation –¥–∞—é—Ç –≤–∞–º –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∑–∞–ø—É—â–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏. 

**NSOperation pros**

NSOperation –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ GCD, –Ω–æ –≤ NSOperation –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç –ø–ª—é—Å—ã –Ω–∞–¥ GCD. –≠—Ç–æ:

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Dependencies)
- –û—Ç–º–µ–Ω–∞ (Easy cancellation)
- –ù–∞–ª–∏—á–∏–µ KVO —Å–≤–æ–π—Å—Ç–≤ (KVO-compliant properties)
- –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (Inheritance) 

**NSOperation states**

–£ –æ–ø–µ—Ä–∞—Ü–∏–π –µ—Å—Ç—å —Å–≤–æ–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:

- **Pending** 
- **Ready** 
- **Executing** 
- **Finished** 
- **Cancelled**

<img src="https://github.com/OrientCue/ios/blob/master/_resources/d8ca715e55224af09176d7d9559895bc.png?raw=true">

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–ª–∞—Å—Å–∞, –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ **Pending**.
–ö–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞, –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É, –æ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **Ready**. –ó–∞ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ ready, –æ–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç YES –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å. –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç NO –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞–∫–∏—Ö-—Ç–æ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω—ã. –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º —Å–≤–æ–π—Å—Ç–≤–æ–º. –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞–∫–∏—Ö-—Ç–æ –∏–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –æ—Ç–ª–∏—á–Ω—ã—Ö –æ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–≤–∏—Å–∏—Ç —Ç–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞, —Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–µ—Ç—Ç–µ—Ä —á—Ç–æ–±—ã –ø–æ–º–µ—Å—Ç–∏—Ç—å —Ç—É–¥–∞ —Å–≤–æ—é –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.
–í –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥–∞ **start** —É –æ–ø–µ—Ä–∞—Ü–∏–∏, —ç—Ç–∏–º –¥–µ–π—Å—Ç–≤–∏–µ–º –≤—ã –ø–µ—Ä–µ–≤–æ–¥–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **Executing**. –≠—Ç–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ executing, —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç YES –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ª–∏–±–æ NO –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–µ—Ç–æ–¥ start –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Å–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–µ NSOperation, –≤–∞–º —Ç–∞–∫–∂–µ —Å–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–µ—Ç—Ç–µ—Ä isExecuting –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å KVO –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è executing —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.
–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—ã–ª –≤—ã–∑–≤–∞–Ω –º–µ—Ç–æ–¥ cancel, —Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **Cancelled**, –¥–∞–Ω–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ cancelled. –î–∞–Ω–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç YES, –µ—Å–ª–∏ –±—ã–ª–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–∞ –æ—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏. –í –¥–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∏–∑ –ª—é–±–æ–≥–æ —Ä–∞–Ω–µ–µ –æ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. 
–ï—Å–ª–∏ –∂–µ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞, —Ç–æ –ø–æ—Å–ª–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è **Executing** –æ–ø–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **Finished**. –î–∞–Ω–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ finished, –æ–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç YES, –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –∏–Ω–∞—á–µ NO. –û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∫–∞ —Å–≤–æ–π—Å—Ç–≤–æ finished –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç YES. –ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–µ—Ç–æ–¥ start –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Å–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–µ NSOperation, –≤–∞–º —Ç–∞–∫–∂–µ —Å–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–µ—Ç—Ç–µ—Ä isFinished –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å KVO –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è executing —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.

## Create NSBlockOperation instance
–ö–∞–∫ —Å–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ, NSOperation —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å. –ß—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π –∫–ª–∞—Å—Å. –ò–Ω–æ–≥–¥–∞ —Ç–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –±—ã–≤–∞–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –∏ –≤–∞–º –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –∑–∞–¥–∞—á–∏. –î–ª—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ NSOperation –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ Foundation - **NSBlockOperation**. –í –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –±–ª–æ–∫ –∫–æ–¥–∞. –í –æ—Ç–ª–∏—á–∏–∏ –æ—Ç GCD, –∑–¥–µ—Å—å –µ—Å—Ç—å –≤—Å–µ –ø—Ä–∏–µ–º—É—â–µ—Å—Ç–≤–∞ NSOperation - KVO –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∏.—Ç.–¥. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ start. 

```objc
NSBlockOperation *blockOperation = [NSBlockOperation blockOperationWithBlock:^{
    // Some task
}];
[blockOperation start];
```


**–í–ê–ñ–ù–û
!!!NSBlockOperation –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏.!!!** 

## Add multiple blocks into NSBlockOperation instance

–•–æ—Ç—è –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞ —ç—Ç–æ –Ω–µ —Ç–∞–∫ –æ—á–µ–≤–∏–¥–Ω–æ, –Ω–æ –≤ –∫–ª–∞—Å—Å–µ NSBlockOperation –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –í—Å–µ –±–ª–æ–∫–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ start. –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –≤ —ç–∫–∑–µ–º–ø–ª—è—Ä NSBlockOperation, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ **addExecutionBlock**.

```objc
NSBlockOperation *blockOperation = [NSBlockOperation new];
[blockOperation addExecutionBlock:^{
    // Task 1
}];
[blockOperation addExecutionBlock:^{
    // Task 2
}];
[blockOperation start];
```

## Track completion of all tasks inside NSBlockOperation instance

NSOperation, –∫–∞–∫ –∏ DispatchGroup –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É, —ç–∫–∑–µ–º–ø–ª—è—Ä NSOperation –ø–æ–º–µ—á–∞–µ—Ç —Å–µ–±—è –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π, –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –±–ª–æ–∫ completionBlock. 

```objc
blockOperation.completionBlock = ^{
    // Some completion action
};
```

## NSOperation subclassing
–ö–ª–∞—Å—Å **NSBlockOperation** —Ö–æ—Ä–æ—à –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á. –ù–æ –µ—Å–ª–∏ –≤–∞–º –Ω–∞–¥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏, –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã –∑–∞–¥–∞—á–∏, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É, —Ç–æ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø–æ–¥–∫–ª–∞—Å—Å NSOperation. 

```objc
@interface CustomOperation : NSOperation
@end
```

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–∫–ª–∞—Å—Å–∞, –æ–±—ã—á–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Ç–æ–¥ main: 

```objc
- (void)main {
   //Some work
}
```

–í–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã —Ä–∞–∑–º–µ—â–∞–µ—Ç–µ –∫–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã, –≥–µ—Ç—Ç–µ—Ä—ã, —Å–µ—Ç—Ç–µ—Ä—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º. –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –≤—ã –∏—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ, –≤—ã –¥–æ–ª–∂–Ω—ã —É–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ –æ–Ω–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤. 
–î–ª—è —Å—Ç–∞—Ä—Ç–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∏ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ start. 

```objc
CustomOperation *operation = [CustomOperation new];
[operation start];
```

**–í–ê–ñ–ù–û
!!! –ï—Å–ª–∏ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ –º–µ—Ç–æ–¥ start, –æ–ø–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –Ω–∞ —Ç–µ–∫—É—â–µ–π –æ—á–µ—Ä–µ–¥–∏. –í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏, –≥–µ—Ç—Ç–µ—Ä isExecuting –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç YES. –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ start –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ RunTime –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é. –ü–æ—ç—Ç–æ–º—É –º–µ—Ç–æ–¥ —Å—Ç–∞—Ä—Ç –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–µ—Ç—Ç–µ—Ä isReady –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç YES.!!!** 

---

## NSOperationQueue

**NSOperationQueue** - –∫–ª–∞—Å—Å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –æ—á–µ—Ä–µ–¥—å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, NSOperationQueue —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é –∏ –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ —Å —Ç–∞–∫–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –µ–π –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–∞. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±–µ–Ω–µ—Ñ–∏—Ç—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏, –Ω–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å NSOperation –≤ –æ—á–µ—Ä–µ–¥—å. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –æ—á–µ—Ä–µ–¥—å, NSOperationQueue –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ready. 
–ö–∞–∫ —Ç–æ–ª—å–∫–æ –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –æ—á–µ—Ä–µ–¥—å, –º—ã –Ω–µ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –∂–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –≤ –¥—Ä—É–≥—É—é –æ—á–µ—Ä–µ–¥—å, —ç–∫–∑–µ–º–ø–ª—è—Ä NSOperation –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑. –û–ø–µ—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∫–∞ –æ–Ω–∞ –Ω–µ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –ª–∏–±–æ –æ—Ç–º–µ–Ω–µ–Ω–∞. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞–ø—Ä—è–º—É—é —É–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –æ–ø–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞. 
–û—á–µ—Ä–µ–¥—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞ –æ–Ω–∞ –Ω–µ –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–∞–º–∞ –æ—á–µ—Ä–µ–¥—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–æ–∫–∞ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –Ω–µ–π –Ω–µ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—Ç—ã –æ—á–µ—Ä–µ–¥–µ–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–∞–º –ø–∞–º—è—Ç–∏. 

## Create queue
–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

`NSOperationQueue *queue = [NSOperationQueue new];`

## Quality of Service
–í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ QoS –∫–∞–∫ –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π, —Ç–∞–∫ –∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ QoS –∏ –æ–Ω–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º. 

```objc
queue.qualityOfService = NSQualityOfServiceUtility;
operation.qualityOfService = NSQualityOfServiceUtility;
```

–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ - **background**. 

### Add operation into a queue

–í—Å–µ —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥—å —ç—Ç–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ addOperation: –¥–∞–ª—å–Ω–µ–π—à—É—é —Ä–∞–±–æ—Ç—É –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ–¥–µ–ª–∞–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. 

`[queue addOperation:operation];`

## Maximum number of operations
NSOperationQueue —ç—Ç–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å—Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å–∫–æ–ª—å–∫–æ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–µ—Å—É—Ä—Å—ã. –ò–Ω–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–¥–∞—á. –î–ª—è —ç—Ç–æ –∂–µ–ª–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Å–≤–æ–π—Å—Ç–≤–µ maxConcurrentOperationCount. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –æ—á–µ—Ä–µ–¥—å —Å–µ—Ä–∏–π–Ω–æ–π, –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ 1. 

```objc
queue.maxConcurrentOperationCount = 3;
```

##  Waiting for completion
–ß—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –æ—á–µ—Ä–µ–¥—å –Ω–∞ –≤—Ä–µ–º—è –ø–æ–∫–∞ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, —Ç.–µ. —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ waitUntilAllOperationsAreFinished: 

```objc
[queue waitUntilAllOperationsAreFinished];
```

## Operation Dependencies

NSOperation –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –¥–∞—é—Ç –Ω–∞–º —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1.	–ú—ã —Ç–æ—á–Ω–æ –∑–Ω–∞–µ–º, —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞—á–Ω–µ—Ç —Å–≤–æ–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç –∫–æ—Ç–æ—Ä–æ–π –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –Ω–µ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞. 
2.	–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–∞—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–µ—Ä–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–æ –≤—Ç–æ—Ä—É—é.

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ **addDependency**: 

```objc
[operation2 addDependency:operation1];
```

–í—ã–∑—ã–≤–∞–µ–º –µ–≥–æ —É –∑–∞–≤–∏—Å–∏–º–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—é, –æ—Ç –∫–æ—Ç–æ—Ä–æ–π –∑–∞–≤–∏—Å–∏—Ç. –í –ª–∏—Å—Ç–∏–Ω–≥–µ operation2 –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞ operation1. –ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –º–µ—Ç–æ–¥–æ–º removeDependency:

```objc
[operation2 removeDependency:operation1];
```

–£ NSOperation –µ—Å—Ç—å —Ä–∏–¥–æ–Ω–ª–∏ —Å–≤–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```objc
@property (readonly, copy) NSArray<NSOperation *> *dependencies;
```

## Cancelling Operations

NSOperation –∏–º–µ–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏. –î–ª—è –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ cancel: 

```objc
[operation cancel];
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–æ isCancelled –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å YES. –≠—Ç–æ –≤—Å–µ, –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –í—Å—è —Ä–∞–±–æ—Ç–∞ –ø–æ –æ—Ç–º–µ–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–µ–∂–∏—Ç –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–µ. –¢–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏.—Ç.–¥ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

```objc
- (void)main {
    // Some hard work part 1
    if (self.isCancelled) { return; } // Some hard work part 2
    if (self.isCancelled) { return; }
    // Some hard work part 3
    // Task is completed
}
```

–í —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥–∏, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ –æ—á–µ—Ä–µ–¥–∏ **cancelAllOperations**:

```objc
[queue cancelAllOperations];
```

–î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –æ—á–µ—Ä–µ–¥–∏ –≤—ã–∑–æ–≤–µ—Ç cancel: —É –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. 

---

## Asynchronous operations

–ö–∞–∫ –±—ã–ª–æ —Å–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ. –ï—Å–ª–∏ –º—ã –∑–∞–ø—É—Å–∫–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é, —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ start:, —Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –Ω–∞ —Ç–µ–∫—É—â–µ–π –æ—á–µ—Ä–µ–¥–∏. –ï—Å–ª–∏ –∂–µ –º—ã –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –≤ NSOperationQueue, —Ç–æ –æ–Ω —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ. –ù–æ –±—ã–≤–∞—é—Ç –∑–∞–¥–∞—á–∏, –∫–æ–≥–¥–∞ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á—É –≤—Ä—É—á–Ω—É—é, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫. –î–ª—è —ç—Ç–æ–≥–æ –º—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é. –ï—Å–ª–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –≤–Ω—É—Ç—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á—É –≤—ã–Ω–µ—Å–µ–º –Ω–∞ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ –∏ –∑–∞–ø—É—Å—Ç–∏–º –æ–ø–µ—Ä–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–º start: —Ç–æ –º–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, –∏ –∑–∞–¥–∞—á–∞ —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π. –ü–æ—ç—Ç–æ–º—É, –∫–æ–≥–¥–∞ –º—ã –¥–µ–ª–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π, –æ—Ç –Ω–∞—Å —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å —á—É—Ç—å –±–æ–ª—å—à–µ –∫–æ–¥–∞ —á–µ–º —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—ã—á–Ω–æ. –ü–æ—Ç–æ–º—É —á—Ç–æ –º—ã –¥–æ–ª–∂–Ω—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏ –∏ —É–≤–µ–¥–æ–º–ª—è—Ç—å –æ–± –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—è KVO –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. 

```objc

//  AsyncOperation.h

#import <Foundation/Foundation.h>

@interface AsyncOperation : NSOperation
- (void)finishOperation;
@end

//  AsyncOperation.m

#import "AsyncOperation.h"

@interface AsyncOperation () {
  BOOL executing;
  BOOL finished;
}

@end

@implementation AsyncOperation

- (BOOL)isAsynchronous {
  return YES;
}

- (BOOL)isExecuting {
  return executing;
}

- (BOOL)isFinished {
  return finished;
}

- (void)start {
  if (self.isCancelled) {
    [self willChangeValueForKey:@"isFinished"];
    finished = YES;
    [self didChangeValueForKey:@"isFinished"];
    return; 
  }
  [self main];
  [self willChangeValueForKey:@"isExecuting"];
  executing = YES;
  [self didChangeValueForKey:@"isExecuting"];

}

- (void)finishOperation {
  [self willChangeValueForKey:@"isExecuting"];
  [self willChangeValueForKey:@"isFinished"];
  executing = NO;
  finished = YES;
  [self didChangeValueForKey:@"isExecuting"];
  [self didChangeValueForKey:@"isFinished"];
}
@end
```

---

## Useful materials ü§ì

[Apple. NSOperation](https://developer.apple.com/documentation/foundation/nsoperation)

[Apple. NSOperationQueue](https://developer.apple.com/documentation/foundation/nsoperationqueue)

[WWDC 2015. Advanced NSOperations](https://developer.apple.com/videos/play/wwdc2015/226/)



